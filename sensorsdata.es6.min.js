var e={1e3:"其他",1001:"发现栏小程序主入口，“最近使用”列表",1005:"顶部搜索框的搜索结果页",1006:"发现栏小程序主入口搜索框的搜索结果页",1007:"单人聊天会话中的小程序消息卡片",1008:"群聊会话中的小程序消息卡片",1011:"扫描二维码",1012:"长按图片识别二维码",1013:"手机相册选取二维码",1014:"小程序模版消息",1017:"前往体验版的入口页",1019:"微信钱包",1020:"公众号 profile 页相关小程序列表",1022:"聊天顶部置顶小程序入口",1023:"安卓系统桌面图标",1024:"小程序 profile 页",1025:"扫描一维码",1026:"附近小程序列表",1027:"顶部搜索框搜索结果页“使用过的小程序”列表",1028:"我的卡包",1029:"卡券详情页",1030:"自动化测试下打开小程序",1031:"长按图片识别一维码",1032:"手机相册选取一维码",1034:"微信支付完成页",1035:"公众号自定义菜单",1036:"App 分享消息卡片",1037:"小程序打开小程序",1038:"从另一个小程序返回",1039:"摇电视",1042:"添加好友搜索框的搜索结果页",1043:"公众号模板消息",1044:"带 shareTicket 的小程序消息卡片（详情)",1045:"朋友圈广告",1046:"朋友圈广告详情页",1047:"扫描小程序码",1048:"长按图片识别小程序码",1049:"手机相册选取小程序码",1052:"卡券的适用门店列表",1053:"搜一搜的结果页",1054:"顶部搜索框小程序快捷入口",1056:"音乐播放器菜单",1057:"钱包中的银行卡详情页",1058:"公众号文章",1059:"体验版小程序绑定邀请页",1064:"微信连Wi-Fi状态栏",1067:"公众号文章广告",1068:"附近小程序列表广告",1069:"移动应用",1071:"钱包中的银行卡列表页",1072:"二维码收款页面",1073:"客服消息列表下发的小程序消息卡片",1074:"公众号会话下发的小程序消息卡片",1077:"摇周边",1078:"连Wi-Fi成功页",1079:"微信游戏中心",1081:"客服消息下发的文字链",1082:"公众号会话下发的文字链",1084:"朋友圈广告原生页",1088:"会话中查看系统消息，打开小程序",1089:"微信聊天主界面下拉",1090:"长按小程序右上角菜单唤出最近使用历史",1091:"公众号文章商品卡片",1092:"城市服务入口",1095:"小程序广告组件",1096:"聊天记录",1097:"微信支付签约页",1099:"页面内嵌插件",1102:"公众号 profile 页服务预览",1103:"发现栏小程序主入口，“我的小程序”列表",1104:"微信聊天主界面下拉，“我的小程序”栏",1106:"聊天主界面下拉，从顶部搜索结果页，打开小程序",1107:"订阅消息，打开小程序",1113:"安卓手机负一屏，打开小程序（三星）",1114:"安卓手机侧边栏，打开小程序（三星）",1124:"扫“一物一码”打开小程序",1125:"长按图片识别“一物一码”",1126:"扫描手机相册中选取的“一物一码”",1129:"微信爬虫访问",1131:"浮窗打开小程序",1131:"浮窗打开小程序",1146:"地理位置信息打开出行类小程序",1148:"卡包-交通卡，打开小程序"},t={},r={para:{name:"sensors",server_url:"",send_timeout:1e3,use_client_time:!1,show_log:!0,allow_amend_share_path:!0,max_string_length:300,datasend_timeout:3e3,source_channel:[],autoTrack:{appLaunch:!0,appShow:!0,appHide:!0},is_persistent_save:!1}},n="object"==typeof n?n:{};n.info=function(){if(r.para.show_log)return console.log.apply(console,arguments)},r.setPara=function(e){r.para=t.extend2Lev(r.para,e),GameGlobal[r.para.name]=r;var i=[];if(t.isArray(r.para.source_channel))for(var a=r.para.source_channel.length,s=0;s<a;s++)-1===" utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" "+r.para.source_channel[s]+" ")&&i.push(r.para.source_channel[s]);r.para.source_channel=i,t.isObject(r.para.register)&&t.extend(t.info.properties,r.para.register),r.para.openid_url||(r.para.openid_url=r.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/,"$1/mp_login")),"number"!=typeof r.para.send_timeout&&(r.para.send_timeout=1e3);var o={send_timeout:6e3,max_length:6};!0===r.para.batch_send?(r.para.batch_send=t.extend({},o),r.para.use_client_time=!0):"object"==typeof r.para.batch_send&&(r.para.use_client_time=!0,r.para.batch_send=t.extend({},o,r.para.batch_send)),r.para.server_url||n.info("请使用 setPara() 方法设置 server_url 数据接收地址,详情可查看https://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0")},r.status={};var i=Array.prototype,a=Object.prototype,s=i.slice,o=a.toString,c=a.hasOwnProperty,u=["$latest_utm_source","$latest_utm_medium","$latest_utm_campaign","$latest_utm_content","$latest_utm_term","latest_sa_utm"];r.status.referrer="直接打开";var p,f,d,l,h,_=null,m=0,g="",y=!1;r.lib_version="0.2.0",p=i.forEach,f=i.indexOf,d=Array.isArray,l={},h=t.each=function(e,t,r){if(null==e)return!1;if(p&&e.forEach===p)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,i=e.length;n<i;n++)if(n in e&&t.call(r,e[n],n,e)===l)return!1}else for(var a in e)if(c.call(e,a)&&t.call(r,e[a],a,e)===l)return!1},t.logger=n,t.extend=function(e){return h(s.call(arguments,1),(function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])})),e},t.extend2Lev=function(e){return h(s.call(arguments,1),(function(r){for(var n in r)void 0!==r[n]&&(t.isObject(r[n])&&t.isObject(e[n])?t.extend(e[n],r[n]):e[n]=r[n])})),e},t.coverExtend=function(e){return h(s.call(arguments,1),(function(t){for(var r in t)void 0!==t[r]&&void 0===e[r]&&(e[r]=t[r])})),e},t.isArray=d||function(e){return"[object Array]"===o.call(e)},t.isFunction=function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},t.isArguments=function(e){return!(!e||!c.call(e,"callee"))},t.toArray=function(e){return e?e.toArray?e.toArray():t.isArray(e)||t.isArguments(e)?s.call(e):t.values(e):[]},t.values=function(e){var t=[];return null==e||h(e,(function(e){t[t.length]=e})),t},t.include=function(e,t){var r=!1;return null==e?r:f&&e.indexOf===f?-1!=e.indexOf(t):(h(e,(function(e){if(r||(r=e===t))return l})),r)},t.isObject=function(e){return null!=e&&"[object Object]"==o.call(e)},t.isEmptyObject=function(e){if(t.isObject(e)){for(var r in e)if(c.call(e,r))return!1;return!0}return!1},t.isUndefined=function(e){return void 0===e},t.isString=function(e){return"[object String]"==o.call(e)},t.isDate=function(e){return"[object Date]"==o.call(e)},t.isBoolean=function(e){return"[object Boolean]"==o.call(e)},t.isNumber=function(e){return"[object Number]"==o.call(e)&&/[\d\.]+/.test(String(e))},t.isJSONString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},t.decodeURIComponent=function(e){var t="";try{t=decodeURIComponent(e)}catch(r){t=e}return t},t.encodeDates=function(e){return t.each(e,(function(r,n){t.isDate(r)?e[n]=t.formatDate(r):t.isObject(r)&&(e[n]=t.encodeDates(r))})),e},t.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())},t.searchObjDate=function(e){t.isObject(e)&&t.each(e,(function(r,n){t.isObject(r)?t.searchObjDate(e[n]):t.isDate(r)&&(e[n]=t.formatDate(r))}))},t.formatString=function(e){return e.length>r.para.max_string_length?(n.info("字符串长度超过限制，已经做截取--"+e),e.slice(0,r.para.max_string_length)):e},t.searchObjString=function(e){t.isObject(e)&&t.each(e,(function(r,n){t.isObject(r)?t.searchObjString(e[n]):t.isString(r)&&(e[n]=t.formatString(r))}))},t.unique=function(e){for(var t,r=[],n={},i=0;i<e.length;i++)(t=e[i])in n||(n[t]=!0,r.push(t));return r},t.strip_sa_properties=function(e){return t.isObject(e)?(t.each(e,(function(r,i){if(t.isArray(r)){var a=[];t.each(r,(function(e){t.isString(e)?a.push(e):n.info("您的数据-",r,"的数组里的值必须是字符串,已经将其删除")})),0!==a.length?e[i]=a:(delete e[i],n.info("已经删除空的数组"))}t.isString(r)||t.isNumber(r)||t.isDate(r)||t.isBoolean(r)||t.isArray(r)||(n.info("您的数据-",r,"-格式不满足要求，我们已经将其删除"),delete e[i])})),e):e},t.strip_empty_properties=function(e){var r={};return t.each(e,(function(e,t){null!=e&&(r[t]=e)})),r},t.utf8Encode=function(e){var t,r,n,i,a="";for(t=r=0,n=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,i=0;i<n;i++){var s=e.charCodeAt(i),o=null;s<128?r++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(r>t&&(a+=e.substring(t,r)),a+=o,t=r=i+1)}return r>t&&(a+=e.substring(t,e.length)),a},t.base64Encode=function(e){var r,n,i,a,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,p="",f=[];if(!e)return e;e=t.utf8Encode(e);do{r=(s=e.charCodeAt(c++)<<16|e.charCodeAt(c++)<<8|e.charCodeAt(c++))>>18&63,n=s>>12&63,i=s>>6&63,a=63&s,f[u++]=o.charAt(r)+o.charAt(n)+o.charAt(i)+o.charAt(a)}while(c<e.length);switch(p=f.join(""),e.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"="}return p},r.initialState={queue:[],isComplete:!1,systemIsComplete:!1,storeIsComplete:!1,checkIsComplete:function(){this.systemIsComplete&&this.storeIsComplete&&(this.isComplete=!0,this.queue.length>0&&(t.each(this.queue,(function(e){r[e[0]].apply(r,s.call(e[1]))})),this.queue=[]))}},t.getCustomUtmFromQuery=function(e,n,i,a){if(!t.isObject(e))return{};var s={};if(e.sa_utm)for(var o in e)"sa_utm"!==o?t.include(r.para.source_channel,o)&&(s[i+o]=e[o]):s[a+o]=e[o];else for(var o in e)-1===" utm_source utm_medium utm_campaign utm_content utm_term ".indexOf(" "+o+" ")?t.include(r.para.source_channel,o)&&(s[i+o]=e[o]):s[n+o]=e[o];return s},t.getObjFromQuery=function(e){var r=e.split("?"),n={};return r&&r[1]?(t.each(r[1].split("&"),(function(e){var t=e.split("=");t[0]&&t[1]&&(n[t[0]]=t[1])})),n):{}},t.setStorageSync=function(e,t){var r=function(){wx.setStorageSync(e,t)};try{r()}catch(e){n.info("set Storage fail --",e);try{r()}catch(e){n.info("set Storage fail again --",e)}}},t.getStorageSync=function(e){var t="";try{t=wx.getStorageSync(e)}catch(r){try{t=wx.getStorageSync(e)}catch(e){n.info("getStorage fail")}}return t},t.getMPScene=function(t){return"number"==typeof t||"string"==typeof t&&""!==t?(t=String(t),e[t]||t):"未取到值"},t.getShareDepth=function(){if("number"==typeof m&&0!==m){var e=r.store.getDistinctId(),t=r.store.getFirstId();return!g||g!==e&&g!==t?m+1:m}return 1},t.setShareInfo=function(e,r){var n={};if(!(e&&t.isObject(e.query)&&e.query.sampshare))return{};if(n=t.decodeURIComponent(e.query.sampshare),!t.isJSONString(n))return{};var i=(n=JSON.parse(n)).d,a=n.i;"string"==typeof a?(r.$share_distinct_id=a,g=a):r.$share_distinct_id="取值异常","number"==typeof i?(r.$share_depth=i,m=i):r.$share_depth="-1"},t.getShareInfo=function(){return JSON.stringify({i:r.store.getDistinctId()||"取值异常",d:t.getShareDepth()})},t.detectOptionQuery=function(e){if(!e||!t.isObject(e.query))return{};var n,i,a,s,o={};return o.query=t.extend({},e.query),"string"==typeof o.query.scene&&(n=o.query,i=["utm_source","utm_content","utm_medium","utm_campaign","utm_term","sa_utm"].concat(r.para.source_channel),a=new RegExp("("+i.join("|")+")%3D","i"),1===(s=Object.keys(n)).length&&"scene"===s[0]&&a.test(n.scene))&&(o.scene=o.query.scene,delete o.query.scene),e.query.q&&e.query.scancode_time&&"101"===String(e.scene).slice(0,3)&&(o.q=String(o.query.q),delete o.query.q,delete o.query.scancode_time),o},t.getMixedQuery=function(e){var r=t.detectOptionQuery(e),n=r.scene,i=r.q,a=r.query;for(var s in a)a[s]=t.decodeURIComponent(a[s]);return n&&(n=-1!==(n=t.decodeURIComponent(n)).indexOf("?")?"?"+n.replace(/\?/g,""):"?"+n,t.extend(a,t.getObjFromQuery(n))),i&&t.extend(a,t.getObjFromQuery(t.decodeURIComponent(i))),a},t.setUtm=function(e,r){var n={},i=t.getMixedQuery(e),a=t.getCustomUtmFromQuery(i,"$","_","$"),s=t.getCustomUtmFromQuery(i,"$latest_","_latest_","$latest_");return n.pre1=a,n.pre2=s,t.extend(r,a),n},t.wxrequest=function(e){var n=wx.request(e);setTimeout((function(){t.isObject(n)&&t.isFunction(n.abort)&&n.abort()}),r.para.datasend_timeout)},t.info={currentProps:{},properties:{$lib:"MiniGame",$lib_version:String("0.2.0")},getSystem:function(){var e=this.properties;function n(){wx.getSystemInfo({success:function(t){var r,n;e.$manufacturer=t.brand,e.$model=t.model,e.$screen_width=Number(t.screenWidth),e.$screen_height=Number(t.screenHeight),e.$os=(r=t.platform,"ios"===(n=r.toLowerCase())?"iOS":"android"===n?"Android":r),e.$os_version=t.system.indexOf(" ")>-1?t.system.split(" ")[1]:t.system},complete:function(){var n=(new Date).getTimezoneOffset();r.para.appid&&(e.$app_id=r.para.appid),t.isNumber(n)&&(e.$timezone_offset=n),r.initialState.systemIsComplete=!0,r.initialState.checkIsComplete()}})}wx.getNetworkType({success:function(t){e.$network_type=t.networkType},complete:n})}},r._=t,r.prepareData=function(e,i){var a={distinct_id:this.store.getDistinctId(),lib:{$lib:"MiniGame",$lib_method:"code",$lib_version:String("0.2.0")},properties:{}};t.extend(a,e),t.isObject(e.properties)&&!t.isEmptyObject(e.properties)&&t.extend(a.properties,e.properties),e.type&&"profile"===e.type.slice(0,7)||(r.para.batch_send&&(a._track_id=Number(String(Math.random()).slice(2,5)+String(Math.random()).slice(2,4)+String(Date.now()).slice(-4))),a.properties=t.extend({},t.info.properties,r.store.getProps(),t.info.currentProps,a.properties),"object"==typeof r.store._state&&"number"==typeof r.store._state.first_visit_day_time&&r.store._state.first_visit_day_time>(new Date).getTime()?a.properties.$is_first_day=!0:a.properties.$is_first_day=!1),a.properties.$time&&t.isDate(a.properties.$time)?(a.time=1*a.properties.$time,delete a.properties.$time):r.para.use_client_time&&(a.time=1*new Date),t.searchObjDate(a),t.searchObjString(a),n.info(a),r.sendStrategy.send(a)},r.store={verifyDistinctId:function(e){return"number"==typeof e&&(e=String(e),/^\d+$/.test(e)||(e="unexpected_id")),"string"==typeof e&&""!==e||(e="unexpected_id"),e},storageInfo:null,getUUID:function(){return Date.now()+"-"+Math.floor(1e7*Math.random())+"-"+Math.random().toString(16).replace(".","")+"-"+String(31242*Math.random()).replace(".","").slice(0,8)},getStorage:function(){return this.storageInfo||(this.storageInfo=r._.getStorageSync("sensorsdata2015_wechat")||""),this.storageInfo},_state:{},mem:{mdata:[],getLength:function(){return this.mdata.length},add:function(e){this.mdata.push(e)},clear:function(e){this.mdata.splice(0,e)}},toState:function(e){var r=null;t.isJSONString(e)?(r=JSON.parse(e)).distinct_id?this._state=r:this.set("distinct_id",this.getUUID()):t.isObject(e)&&(r=e).distinct_id?this._state=r:this.set("distinct_id",this.getUUID())},getFirstId:function(){return this._state._first_id||this._state.first_id},getDistinctId:function(){return this._state._distinct_id||this._state.distinct_id},getProps:function(){return this._state.props||{}},setProps:function(e,r){var n=this._state.props||{};r?this.set("props",e):(t.extend(n,e),this.set("props",n))},set:function(e,t){var r={};for(var n in"string"==typeof e?r[e]=t:"object"==typeof e&&(r=e),this._state=this._state||{},r)this._state[n]=r[n],"first_id"===n?delete this._state._first_id:"distinct_id"===n&&delete this._state._distinct_id;this.save()},change:function(e,t){this._state["_"+e]=t},save:function(){var e=JSON.parse(JSON.stringify(this._state));delete e._first_id,delete e._distinct_id,r._.setStorageSync("sensorsdata2015_wechat",e)},init:function(){var e=this.getStorage();if(e)this.toState(e);else{y=!0;var t=new Date,n=t.getTime();t.setHours(23),t.setMinutes(59),t.setSeconds(60),r.setOnceProfile({$first_visit_time:new Date}),this.set({distinct_id:this.getUUID(),first_visit_time:n,first_visit_day_time:t.getTime()})}}},r.setProfile=function(e,t){r.prepareData({type:"profile_set",properties:e},t)},r.setOnceProfile=function(e,t){r.prepareData({type:"profile_set_once",properties:e},t)},r.appendProfile=function(e,i){if(!t.isObject(e))return!1;t.each(e,(function(r,i){t.isString(r)?e[i]=[r]:t.isArray(r)||(delete e[i],n.info("appendProfile属性的值必须是字符串或者数组"))})),r.prepareData({type:"profile_append",properties:e},i)},r.incrementProfile=function(e,n){if(!t.isObject(e))return!1;var i=e;t.isString(e)&&((e={})[i]=1),r.prepareData({type:"profile_increment",properties:e},n)},r.track=function(e,t,r){this.prepareData({type:"track",event:e,properties:t},r)},r.identify=function(e,t){if("string"!=typeof e&&"number"!=typeof e)return!1;e=r.store.verifyDistinctId(e);var n=r.store.getFirstId();!0===t?n?r.store.set("first_id",e):r.store.set("distinct_id",e):n?r.store.change("first_id",e):r.store.change("distinct_id",e)},r.trackSignup=function(e,t,n,i){var a=r.store.getFirstId()||r.store.getDistinctId();r.store.set("distinct_id",e),r.prepareData({original_id:a,distinct_id:e,type:"track_signup",event:t,properties:n},i)},r.registerApp=function(e){t.isObject(e)&&!t.isEmptyObject(e)&&(t.info.currentProps=t.extend(t.info.currentProps,e))},r.register=function(e){t.isObject(e)&&!t.isEmptyObject(e)&&r.store.setProps(e)},r.clearAllRegister=function(){r.store.setProps({},!0)},r.clearAllProps=function(e){var n=r.store.getProps(),i={};t.isArray(e)&&(t.each(n,(function(r,n){t.include(e,n)||(i[n]=r)})),r.store.setProps(i,!0))},r.clearAppRegister=function(e){t.isArray(e)&&t.each(t.info.currentProps,(function(r,n){t.include(e,n)&&delete t.info.currentProps[n]}))},r.setLatestChannel=function(e){t.isEmptyObject(e)||(function(e,t){var r=!1;for(var n in t)e[t[n]]&&(r=!0);return r}(e,u)&&(r.clearAppRegister(u),r.clearAllProps(u)),r.para.is_persistent_save?r.register(e):r.registerApp(e))},r.login=function(e){if("string"!=typeof e&&"number"!=typeof e)return!1;e=r.store.verifyDistinctId(e);var t=r.store.getFirstId(),n=r.store.getDistinctId();e!==n&&(t||r.store.set("first_id",n),r.trackSignup(e,"$SignUp"))},r.openid={getRequest:function(e){wx.login({success:function(n){n.code&&r.para.appid&&r.para.openid_url?t.wxrequest({url:r.para.openid_url+"&code="+n.code+"&appid="+r.para.appid,method:"GET",complete:function(r){t.isObject(r)&&t.isObject(r.data)&&r.data.openid?e(r.data.openid):e()}}):e()}})},getWXStorage:function(){var e=r.store.getStorage();if(e&&t.isObject(e))return e.openid},getOpenid:function(e){if(!r.para.appid)return e(),!1;var t=this.getWXStorage();t?e(t):this.getRequest(e)}},r.initial=function(){this._.info.getSystem(),this.store.init()},r.init=function(e){if(!0===this.hasInit)return!1;this.hasInit=!0,r.para.batch_send&&r.sendStrategy.batchInterval(),r.initialState.storeIsComplete=!0,r.initialState.checkIsComplete()},r.getPresetProperties=function(){if(t.info&&t.info.properties&&t.info.properties.$lib){var e={};t.each(t.info.currentProps,(function(t,r){0===r.indexOf("$")&&(e[r]=t)}));var n=t.extend(e,t.info.properties,r.store.getProps());return delete n.$lib,n}return{}},t.autoExeQueue=function(){return{items:[],enqueue:function(e){this.items.push(e),this.start()},dequeue:function(){return this.items.shift()},getCurrentItem:function(){return this.items[0]},isRun:!1,start:function(){this.items.length>0&&!this.isRun&&(this.isRun=!0,this.getCurrentItem().start())},close:function(){this.dequeue(),this.isRun=!1,this.start()}}},r.requestQueue=function(e){this.url=e.url},r.requestQueue.prototype.isEnd=function(){this.received||(this.received=!0,this.close())},r.requestQueue.prototype.start=function(){var e=this;setTimeout((function(){e.isEnd()}),r.para.send_timeout),t.wxrequest({url:this.url,method:"GET",complete:function(){e.isEnd()}})},r.dataQueue=t.autoExeQueue(),r.sendStrategy={dataHasSend:!0,dataHasChange:!1,onAppHide:function(){r.para.batch_send&&this.batchSend()},send:function(e){if(!r.para.server_url)return!1;if(r.para.batch_send){if(this.dataHasChange=!0,r.store.mem.getLength()>=300)return n.info("数据量存储过大，有异常"),!1;r.store.mem.add(e),r.store.mem.getLength()>=r.para.batch_send.max_length&&this.batchSend()}else this.queueSend(e)},queueSend:function(e){e=JSON.stringify(e),e=-1!==r.para.server_url.indexOf("?")?r.para.server_url+"&data="+encodeURIComponent(t.base64Encode(e)):r.para.server_url+"?data="+encodeURIComponent(t.base64Encode(e));var n=new r.requestQueue({url:e});n.close=function(){r.dataQueue.close()},r.dataQueue.enqueue(n)},wxrequest:function(e){if(t.isArray(e.data)&&e.data.length>0){var n=Date.now();e.data.forEach((function(e){e._flush_time=n})),e.data=JSON.stringify(e.data),t.wxrequest({url:r.para.server_url,method:"POST",dataType:"text",data:"data_list="+encodeURIComponent(t.base64Encode(e.data)),success:function(){e.success(e.len)}})}else e.success(e.len)},batchSend:function(){if(this.dataHasSend){var e=r.store.mem.mdata,t=e.length;t>0&&(this.dataHasSend=!1,this.wxrequest({data:e,len:t,success:this.batchRemove.bind(this)}))}},batchRemove:function(e){r.store.mem.clear(e),this.dataHasSend=!0,this.dataHasChange=!0,this.batchWrite()},is_first_batch_write:!0,batchWrite:function(){var e=this;this.dataHasChange&&(this.is_first_batch_write&&(this.is_first_batch_write=!1,setTimeout((function(){e.batchSend()}),1e3)),this.dataHasChange=!1,r._.setStorageSync("sensors_mp_prepare_data",r.store.mem.mdata))},batchInterval:function(){var e=this;!function t(){setTimeout((function(){e.batchWrite(),t()}),500)}(),function t(){setTimeout((function(){e.batchSend(),t()}),r.para.batch_send.send_timeout)}()}},r.setOpenid=function(e,t){r.store.set("openid",e),t?r.store.set("distinct_id",e):r.identify(e,!0)},r.initWithOpenid=function(e,n){(e=e||{}).appid&&(r.para.appid=e.appid),r.openid.getOpenid((function(i){i&&r.setOpenid(i,e.isCoverLogin),n&&t.isFunction(n)&&n(i),r.init(e)}))},t.each(["login","setProfile","setOnceProfile","track","quick","incrementProfile","appendProfile"],(function(e){var t=r[e];r[e]=function(){r.initialState.isComplete?t.apply(r,arguments):r.initialState.queue.push([e,arguments])}})),t.setQuery=function(e,r){if(e&&t.isObject(e)&&!t.isEmptyObject(e)){var n=[];return t.each(e,(function(e,i){"q"===i&&t.isString(e)&&0===e.indexOf("http")||"scene"===i||(r?n.push(i+"="+e):n.push(i+"="+t.decodeURIComponent(e)))})),n.join("&")}return""},r.autoTrackCustom={trackCustom:function(e,n,i){var a=r.para.autoTrack[e],s="";r.para.autoTrack&&a&&("function"==typeof a?(s=a(),t.isObject(s)&&t.extend(n,s)):t.isObject(a)&&(t.extend(n,a),r.para.autoTrack[e]=!0),r.track(i,n))},appLaunch:function(e,n){"object"!=typeof this||this.trackCustom||(this[r.para.name]=r);var i={};t.setShareInfo(e,i);var a=t.setUtm(e,i);y?(i.$is_first_time=!0,t.isEmptyObject(a.pre1)||r.setOnceProfile(a.pre1)):i.$is_first_time=!1,r.setLatestChannel(a.pre2),i.$scene=t.getMPScene(e.scene),r.registerApp({$latest_scene:i.$scene}),i.$url_query=t.setQuery(e.query),n?(i=t.extend(i,n),r.track("$MPLaunch",i)):r.para.autoTrack&&r.para.autoTrack.appLaunch&&r.autoTrackCustom.trackCustom("appLaunch",i,"$MPLaunch"),y=!1},appShow:function(e,n){var i={};_=(new Date).getTime(),t.setShareInfo(e,i);var a=t.setUtm(e,i);r.setLatestChannel(a.pre2),i.$scene=t.getMPScene(e.scene),r.registerApp({$latest_scene:i.$scene}),i.$url_query=t.setQuery(e.query),r.autoTrackCustom.trackCustom("appShow",i,"$MPShow")},appHide:function(e){var t=(new Date).getTime(),n={};_&&t-_>0&&(t-_)/36e5<24&&(n.event_duration=(t-_)/1e3),r.autoTrackCustom.trackCustom("appHide",n,"$MPHide"),r.sendStrategy.onAppHide()}},r.quick=function(){var e=arguments[0],i=arguments[1],a=arguments[2],s=t.isObject(a)?a:{};if("getAnonymousID"===e){if(!t.isEmptyObject(r.store._state))return r.store._state._first_id||r.store._state.first_id||r.store._state._distinct_id||r.store._state.distinct_id;n.info("请先初始化SDK")}else"appLaunch"===e||"appShow"===e?i?r.autoTrackCustom[e](i,s):n.info("App的launch和show，在sensors.quick第二个参数必须传入App的options参数"):"appHide"===e&&(s=t.isObject(i)?i:{},r.autoTrackCustom[e](s))};const b=(S=!1,function(){S||(S=!0,r.para.autoTrack&&r.para.autoTrack.appLaunch&&r.quick("appLaunch",wx.getLaunchOptionsSync()))});var S;wx.onShow(e=>{b(),r.para.autoTrack&&r.para.autoTrack.appShow&&r.quick("appShow",e)}),wx.onHide(e=>{r.para.autoTrack&&r.para.autoTrack.appHide&&r.quick("appHide")}),r.onShareAppMessage=function(e){wx.onShareAppMessage((function(){if(r.track("$MPShare",{$share_depth:t.getShareDepth()}),"function"==typeof e){let n=e.call(wx);return r.para.allow_amend_share_path&&("object"!=typeof n&&(n={},n.query=""),n.query="string"==typeof n.query?n.query:"","object"==typeof n&&"string"==typeof n.query&&n.query&&"&"!==n.query.slice(-1)&&(n.query=n.query+"&"),n.query=n.query+"sampshare="+encodeURIComponent(t.getShareInfo())),n}}))},r.initial();export default r;
